<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modernized City Delivery Pivot Opportunity Model</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/2.1.8/css/dataTables.bootstrap5.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4"></script>
    <style>
        body { font-family: 'Verdana', sans-serif; background-color: #f8f9fa; }
        .header-bg { background-color: #003263; color: white; }
        .kpi-row { font-size: 0.875rem; }
        .daily-opp { background-color: #ccccff; }
        .achievement-cell { text-align: center; font-weight: bold; }
        .chart-icon { width: 20px; height: 20px; }
        .export-btn { background-color: #f8f8ff; padding: 10px; text-align: center; }
        /* Color coding for % Achieved (based on your original logic) */
        .ach-low { background-color: #FF6666; } /* <75% */
        .ach-med { background-color: #FFFF66; } /* 75-85% */
        .ach-high { background-color: #66FF66; } /* 85-95% */
        .ach-top { background-color: #6666FF; } /* >=95% */
    </style>
</head>
<body>
    <div class="container my-4">
        <!-- Navigation Header -->
        <div class="row">
            <div class="col-12 header-bg p-2 text-center">
                <a href="#" class="text-white me-3">Return to Range Selection</a> -->
                <a href="#" class="text-white">National Level</a> -->
                <a href="#" class="text-white">Cluster Level</a>
            </div>
        </div>

        <!-- Title -->
        <div class="row mt-3">
            <div class="col-12 header-bg p-3 text-center">
                <h5 class="mb-0">Ma-Ri - MPOO G City Delivery Pivot Opportunity Model 11 Delivery Days 11/22/2025 to 12/05/2025</h5>
            </div>
        </div>

        <!-- KPI Summary Rows -->
        <div class="row mt-3 header-bg text-white kpi-row">
            <div class="col-md-4 p-2">Base number of Equivalent City Routes: 476</div>
            <div class="col-md-4 p-2">Earned Rts Equivalent Workload: 430</div>
            <div class="col-md-4 p-2">Actual Rts Equivalent Workhours: 449</div>
        </div>
        <div class="row header-bg text-white kpi-row">
            <div class="col-md-4 p-2">Daily Pivot Opportunity: 46</div>
            <div class="col-md-4 p-2">Rts Pivot Performance Actual: 27</div>
            <div class="col-md-4 p-2">Pivot Opportunity % Achieved: 59%</div>
        </div>

        <!-- Modern Charts for KPIs -->
        <div class="row mt-4">
            <!-- Bar Chart for Overall KPIs -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">KPI Summary Bar Chart</div>
                    <div class="card-body">
                        <canvas id="kpiBarChart"></canvas>
                    </div>
                </div>
            </div>
            <!-- Doughnut Chart for % Achieved -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Pivot Opportunity % Achieved</div>
                    <div class="card-body">
                        <canvas id="achievementDoughnut"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modernized Table -->
        <div class="row mt-4">
            <div class="col-12">
                <table id="pivotTable" class="table table-striped table-hover table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>Chart</th>
                            <th>Fin Nbr</th>
                            <th>Unit Name</th>
                            <th>Base Nbr of Equivalent City Rts</th>
                            <th>Earned Rts Equivalent Workload</th>
                            <th>Actual Rts Equivalent Workhours</th>
                            <th>Daily Pivot Opportunity</th>
                            <th>Rts Pivot Performance Actual</th>
                            <th>Pivot Opportunity % Achieved</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Sample row from your screenshot; repeat for others -->
                        <tr>
                            <td><canvas class="chart-icon" data-chart-data="[1.84, 0.93, 0.50]"></canvas></td> <!-- Mini sparkline -->
                            <td>245168</td>
                            <td>ABINGTON PO</td>
                            <td>14.69</td>
                            <td>12.84</td>
                            <td>13.76</td>
                            <td class="daily-opp">1.84</td>
                            <td>0.93</td>
                            <td class="achievement-cell ach-top">50.30</td>
                        </tr>
                        <!-- Add more rows similarly... -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Export Section -->
        <div class="row mt-3 export-btn">
            <div class="col-12">
                <a href="#" class="btn btn-primary">Send to Excel National Area Level Data</a>
                <a href="#" class="btn btn-primary ms-3">Send to Excel National Unit Level Data</a>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.1.8/js/dataTables.bootstrap5.js"></script>
    <script>
        // Initialize DataTable
        new DataTable('#pivotTable', { order: [[8, 'desc']] }); // Sort by % Achieved descending

        // KPI Bar Chart
        new Chart(document.getElementById('kpiBarChart'), {
            type: 'bar',
            data: {
                labels: ['Base Routes', 'Earned Workload', 'Actual Workhours', 'Daily Opp', 'Perf Actual'],
                datasets: [{ label: 'Values', data: [476, 430, 449, 46, 27], backgroundColor: ['#003263', '#66FF66', '#FF6666', '#ccccff', '#6666FF'] }]
            },
            options: { scales: { y: { beginAtZero: true } } }
        });

        // Achievement Doughnut Chart
        new Chart(document.getElementById('achievementDoughnut'), {
            type: 'doughnut',
            data: {
                labels: ['Achieved', 'Remaining'],
                datasets: [{ data: [59, 41], backgroundColor: ['#66FF66', '#FF6666'] }]
            },
            options: { cutout: '70%', plugins: { legend: { position: 'bottom' } } }
        });

        // Mini Sparklines in Chart Column (one per row)
        document.querySelectorAll('.chart-icon').forEach(canvas => {
            new Chart(canvas, {
                type: 'line',
                data: { labels: ['Day1', 'Day2', 'Day3'], datasets: [{ data: JSON.parse(canvas.dataset.chartData), borderColor: '#003263', fill: false }] },
                options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
            });
        });

        // Dynamic Color Coding for % Achieved (run after table load)
        document.querySelectorAll('.achievement-cell').forEach(cell => {
            const val = parseFloat(cell.textContent);
            if (val < 75) cell.classList.add('ach-low');
            else if (val < 85) cell.classList.add('ach-med');
            else if (val < 95) cell.classList.add('ach-high');
            else cell.classList.add('ach-top');
        });
    </script>
</body>
</html>
